{% extends "base.html"%}
{% block content %}

<div class="grid-container">
  <div class="item1">
    <h1>Section 1</h1>
    <p>This study will contain three informational videos and the corresponding quizzes. You can interact with the
      chat guide and rely on it
      to help you to understand the concept better. </p>
  </div>
  <div class="item2">
    <ul>
      <li><a class="active" href="#home">Section 1 <i style="color:green;" class="fas fa-check-circle"></i></a></li>
      {%if submitted%}
      <li><a href="{{url_for('section_2')}}">Section 2</a></li>
      {% else %}
      <li><a class="isDisabled" disabled>Section 2</a></li>
      {% endif %}
      <li><a class="isDisabled" href="" disabled>Section 3</a></li>

    </ul>

  </div>
  <div class="item3">
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <div id="player" class="video"></div>

    <!-- <div class="embed-responsive embed-responsive-16by9" style="width:80%;">
        <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/csgEVurrBpU" frameborder="0"
          allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </div> -->
  </div>
  <div class="item4">
    <div id="chatbot-text" class="hidestart">

      <div class="received_msg">
        <div class="received_withd_msg">
          <p>Hello! Here is a hint for the user</p>
        </div>
        <span class="time_date">
          <p id="tell-me-more-A" class="more-link" onclick="showMoreA()">Show more ></p>
        </span>

      </div>

      <div class="received_msg">
        <div class="received_withd_msg">
          <p id="more-text-A" class="more"> More text for the user </p>
        </div>
      </div>
      <hr id="line1" class="B">
      <div class="received_msg">
        <div class="received_withd_msg">
          <p id="hint2" class="B">Another hint for the user</p>
        </div>
        <span class="time_date">
          <p id="tell-me-more-B" class="more-link B" onclick="showMoreB()">Show more ></p>
        </span>
      </div>

      <div class="received_msg">
        <div class="received_withd_msg">
          <p id="more-text-B" class="more"> More text for the user again </p>
        </div>
      </div>

    </div>
    <div id="chatbot" class="col-sm-4">
      <div class="item">
        <p>
          <span id="badge" class="notify-badge">1</span>
          <img src="../static/chatbot-icon.png" alt="chatbot-icon" width="50" height="50">
        </p>
      </div>
    </div>

  </div>
  <div id="quiz-body" class="item5">
    <div class="quiz">

      <h5>Quiz</h5>

      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis accumsan ultricies pretium. Suspendisse in
      ultricies
      libero, eu venenatis arcu. Vivamus congue, augue non consequat fringilla, dolor quam accumsan massa, sed
      efficitur
      erat mi sed neque. Sed pulvinar est mi, et vehicula dui congue non. Nam ut magna eget diam egestas dictum.
      Nullam
      varius vehicula gravida. Mauris eros risus, ultrices eget lacinia mattis, molestie fermentum felis. Phasellus
      mauris mauris, bibendum at diam vitae, tempus pretium erat. Duis tempus cursus consectetur. Suspendisse ut
      convallis massa.
      <br>
      <br>

      <br>
      <form method="POST">

        <div class="form-check">
          {{ form.hidden_tag() }}
          <h6>Question 1:</h6>
          {{ form.question1.label() }} {{ form.question1() }}
          <h6>Question 2:</h6>
          {{ form.question2.label() }} {{ form.question2() }}

          <button id="fake-button" class='btn btn-secondary' disabled></button>
          <div id="submit-area" class="submit-area">
            {{ form.submit(id='submit', class='btn btn-info') }}
          </div>

        </div>

        {%if submitted%}
        <br>
        <div class="submitted">Thank you for submitting! Click next section to continue.</div>
        {%endif%}

      </form>
    </div>
    <br>

    {#
    <div class="section-button">
      <a href="{{url_for('section_2')}}"> <button type="button" class="btn btn-success">Next Section</button></a>
    </div>
#}

  </div>

</div>

<script type="text/javascript">
  // stop time in seconds; we can add more depending on what we need
  var stopTime1 = 6.0;
  var stopTime2 = 12.0;
  var interval;

  // 2. This code loads the IFrame Player API code asynchronously.
  var tag = document.createElement('script');

  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  // 3. This function creates an <iframe> (and YouTube player)
  //    after the API code downloads.
  var player;
  var start = false;

  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      height: '480',
      width: '854',
      videoId: 'csgEVurrBpU',
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange
      }
    });
  }

  // 4. The API will call this function when the video player is ready.
  function onPlayerReady(event) {
    event.target.playVideo();
    interval = setInterval(checkTime, 1000);

  }

  function checkTime() {
    var currTime = player.getCurrentTime()
    console.log(currTime);

    // this can be amended for all the times we might need 
    if (currTime < (stopTime1 + 0.5) && currTime > (stopTime1 - 0.5)) {
      pauseVideo(1);
    } else if (currTime < (stopTime2 + 0.5) && currTime > (stopTime2 - 0.5)) {
      pauseVideo(2);
    }
  }

  // shows the first "tell me more"
  function showMoreA() {
    var moreText = document.getElementById("more-text-A");
    //   var moreText = document.getElementById(item_id);
    moreText.style.display = "block";


    var badge = document.getElementById("badge");
    if (badge.style.display === "block") {
      badge.style.display = 'none';
    }
  }

  // shows the second "tell me more "
  function showMoreB() {
    var moreText = document.getElementById("more-text-B");
    //   var moreText = document.getElementById(item_id);
    moreText.style.display = "block";


    var badge = document.getElementById("badge");
    if (badge.style.display === "block") {
      badge.style.display = 'none';
    }
  }

  // restart the timer if the video has been paused 
  function onPlayerStateChange(event) {

    if (event.data == YT.PlayerState.PLAYING && start) {
      interval = setInterval(checkTime, 1000);
    } else if (event.data == YT.PlayerState.PAUSED) {
      if (interval) {
        clearInterval(interval);
      }
    } else if (event.data == YT.PlayerState.ENDED) {
      clearInterval(interval);
      console.log("the video has ended ");
      document.getElementById("submit-area").style.display = 'block';
      document.getElementById("fake-button").style.display = 'none';
      document.getElementById("quiz-body").style.display = 'block';
    }
  }

  function stopVideo() {
    player.stopVideo();
  }

  function pauseVideo(action) {
    player.pauseVideo();

    switch (action) {
      case 1:
        console.log("case1");
        var bot = document.getElementById("chatbot-text"); //this works
        bot.style.display = 'block';
        start = true;
        break;
      case 2:
        console.log("case2");
        var line = document.getElementById("line1")
        var text = document.getElementById("hint2");
        var more = document.getElementById("tell-me-more-B");
        line.style.display = 'block';
        text.style.display = 'block';
        more.style.display = 'block';
        break;


    }
  }

  // potentially can use this to click to open/close chatbot?
  function toggleChatbot() {
    console.log("toggle")

    var badge = document.getElementById("badge");
    if (badge.style.display === "block") {
      badge.style.display = 'none';
    }
  }
</script>
{% endblock %}